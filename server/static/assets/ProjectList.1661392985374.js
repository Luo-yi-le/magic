var L=Object.defineProperty,S=Object.defineProperties;var _=Object.getOwnPropertyDescriptors;var U=Object.getOwnPropertySymbols;var G=Object.prototype.hasOwnProperty,R=Object.prototype.propertyIsEnumerable;var N=(e,l,d)=>l in e?L(e,l,{enumerable:!0,configurable:!0,writable:!0,value:d}):e[l]=d,k=(e,l)=>{for(var d in l||(l={}))G.call(l,d)&&N(e,d,l[d]);if(U)for(var d of U(l))R.call(l,d)&&N(e,d,l[d]);return e},T=(e,l)=>S(e,_(l));import{p}from"./api.16613929853744.js";import{b as H}from"./api.16613929853742.js";import{n as B,b as J}from"./assert.1661392985374.js";import{_ as K,A as O,r as Q,o as W,t as X,b as i,C as Y,d as m,e as z,g as a,w as t,h as g,x as h,k as c,B as u,i as I,F as Z,j as x,E as y,G as ee}from"./index.1661392985374.js";import"./Api.1661392985374.js";const oe=O({name:"ProjectList",components:{},setup(){const e=Q({permissions:{saveProject:"project:save",delProject:"project:del",saveMember:"project:member:add",delMember:"project:member:del",saveEnv:"project:env:add"},query:{pageNum:1,pageSize:10,name:null},total:0,projects:[],btnLoading:!1,chooseId:null,chooseData:null,addProjectDialog:{title:"\u65B0\u589E\u9879\u76EE",visible:!1,form:{name:"",remark:""}},showEnvDialog:{visible:!1,envs:[],title:"",addVisible:!1,envForm:{name:"",remark:"",projectId:0}},showMemDialog:{visible:!1,chooseId:null,chooseData:null,query:{pageSize:8,pageNum:1,projectId:null},members:{list:[],total:null},title:"",addVisible:!1,memForm:{},accounts:[]}});W(()=>{l()});const l=async()=>{let o=await p.projects.request(e.query);e.projects=o.list,e.total=o.total},d=o=>{e.query.pageNum=o,l()},q=o=>{o?e.addProjectDialog.form=k({},o):e.addProjectDialog.form={},e.addProjectDialog.visible=!0},j=()=>{e.addProjectDialog.visible=!1,e.addProjectDialog.form={}},$=async()=>{const o=e.addProjectDialog.form;B(o.name,"\u9879\u76EE\u540D\u4E0D\u80FD\u4E3A\u7A7A"),B(o.remark,"\u9879\u76EE\u63CF\u8FF0\u4E0D\u80FD\u4E3A\u7A7A"),await p.saveProject.request(o),y.success("\u4FDD\u5B58\u6210\u529F"),l(),j()},s=async()=>{try{await ee.confirm("\u786E\u5B9A\u5220\u9664\u8BE5\u9879\u76EE?","\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}),await p.delProject.request({id:e.chooseId}),y.success("\u5220\u9664\u6210\u529F"),e.chooseData=null,e.chooseId=null,l()}catch{}},D=o=>{!o||(e.chooseId=o.id,e.chooseData=o)},M=async o=>{e.showMemDialog.query.projectId=o.id,await b(),e.showMemDialog.title=`${o.name}\u7684\u6210\u5458\u4FE1\u606F`,e.showMemDialog.visible=!0},n=o=>{!o||(e.showMemDialog.chooseData=o,e.showMemDialog.chooseId=o.id)},F=async()=>{J(e.showMemDialog.chooseData,"\u8BF7\u9009\u9009\u62E9\u6210\u5458"),await p.deleteProjectMem.request(e.showMemDialog.chooseData),y.success("\u79FB\u9664\u6210\u529F"),b()},b=async()=>{const o=await p.projectMems.request(e.showMemDialog.query);e.showMemDialog.members.list=o.list,e.showMemDialog.members.total=o.total},C=async o=>{e.showEnvDialog.envs=await p.projectEnvs.request({projectId:o.id}),e.showEnvDialog.title=`${o.name}\u7684\u73AF\u5883\u4FE1\u606F`,e.showEnvDialog.visible=!0},V=()=>{e.showMemDialog.addVisible=!0},f=async()=>{const o=e.showMemDialog.memForm;o.projectId=e.chooseData.id,B(o.accountId,"\u8BF7\u5148\u9009\u62E9\u8D26\u53F7"),await p.saveProjectMem.request(o),y.success("\u4FDD\u5B58\u6210\u529F"),b(),v()},v=()=>{e.showMemDialog.memForm={},e.showMemDialog.addVisible=!1,e.showMemDialog.chooseData=null,e.showMemDialog.chooseId=null},w=o=>{H.list.request({username:o}).then(E=>{e.showMemDialog.accounts=E.list})},A=()=>{e.showEnvDialog.addVisible=!0},P=async()=>{const o=e.showEnvDialog.envForm;o.projectId=e.chooseData.id,await p.saveProjectEnv.request(o),y.success("\u4FDD\u5B58\u6210\u529F"),e.showEnvDialog.envs=await p.projectEnvs.request({projectId:o.projectId}),r()},r=()=>{e.showEnvDialog.envForm={},e.showEnvDialog.addVisible=!1};return T(k({},X(e)),{search:l,handlePageChange:d,choose:D,showAddProjectDialog:q,addProject:$,delProject:s,cancelAddProject:j,showMembers:M,setMemebers:b,showEnv:C,showAddMemberDialog:V,addMember:f,chooseMember:n,deleteMember:F,cancelAddMember:v,showAddEnvDialog:A,addEnv:P,cancelAddEnv:r,getAccount:w})}}),le={class:"project-list"},ae=u("\u6DFB\u52A0"),te=u("\u7F16\u8F91"),se=u("\u6210\u5458\u7BA1\u7406"),ue=u("\u73AF\u5883\u7BA1\u7406"),ne=u("\u5220\u9664"),de={style:{float:"right"}},ie=g("i",null,null,-1),re={class:"dialog-footer"},me=u("\u53D6 \u6D88"),pe=u("\u786E \u5B9A"),ce={class:"toolbar"},ge=u("\u6DFB\u52A0"),he={class:"dialog-footer"},De=u("\u53D6 \u6D88"),be=u("\u786E \u5B9A"),fe={class:"toolbar"},we=u("\u6DFB\u52A0"),ve=u("\u79FB\u9664"),Fe=g("i",null,null,-1),Ee={class:"dialog-footer"},ye=u("\u53D6 \u6D88"),Me=u("\u786E \u5B9A");function je(e,l,d,q,j,$){const s=i("el-button"),D=i("el-input"),M=i("el-radio"),n=i("el-table-column"),F=i("el-table"),b=i("el-pagination"),C=i("el-row"),V=i("el-card"),f=i("el-form-item"),v=i("el-form"),w=i("el-dialog"),A=i("el-option"),P=i("el-select"),r=Y("auth");return m(),z("div",le,[a(V,null,{default:t(()=>[g("div",null,[h((m(),c(s,{onClick:e.showAddProjectDialog,type:"primary",icon:"plus"},{default:t(()=>[ae]),_:1},8,["onClick"])),[[r,e.permissions.saveProject]]),h((m(),c(s,{onClick:l[0]||(l[0]=o=>e.showAddProjectDialog(e.chooseData)),disabled:e.chooseId==null,type:"primary",icon:"edit"},{default:t(()=>[te]),_:1},8,["disabled"])),[[r,e.permissions.saveProject]]),a(s,{onClick:l[1]||(l[1]=o=>e.showMembers(e.chooseData)),disabled:e.chooseId==null,type:"success",icon:"user"},{default:t(()=>[se]),_:1},8,["disabled"]),a(s,{onClick:l[2]||(l[2]=o=>e.showEnv(e.chooseData)),disabled:e.chooseId==null,type:"info",icon:"setting"},{default:t(()=>[ue]),_:1},8,["disabled"]),h((m(),c(s,{onClick:e.delProject,disabled:e.chooseId==null,type:"danger",icon:"delete"},{default:t(()=>[ne]),_:1},8,["onClick","disabled"])),[[r,e.permissions.delProject]]),g("div",de,[a(D,{class:"mr2",placeholder:"\u8BF7\u8F93\u5165\u9879\u76EE\u540D\uFF01",style:{width:"200px"},modelValue:e.query.name,"onUpdate:modelValue":l[3]||(l[3]=o=>e.query.name=o),onClear:e.search,clearable:""},null,8,["modelValue","onClear"]),a(s,{onClick:e.search,type:"success",icon:"search"},null,8,["onClick"])])]),a(F,{data:e.projects,onCurrentChange:e.choose,ref:"table",style:{width:"100%"}},{default:t(()=>[a(n,{label:"\u9009\u62E9",width:"55px"},{default:t(o=>[a(M,{modelValue:e.chooseId,"onUpdate:modelValue":l[4]||(l[4]=E=>e.chooseId=E),label:o.row.id},{default:t(()=>[ie]),_:2},1032,["modelValue","label"])]),_:1}),a(n,{prop:"name",label:"\u9879\u76EE\u540D"}),a(n,{prop:"remark",label:"\u63CF\u8FF0","min-width":"180px","show-overflow-tooltip":""}),a(n,{prop:"createTime",label:"\u521B\u5EFA\u65F6\u95F4"},{default:t(o=>[u(I(e.$filters.dateFormat(o.row.createTime)),1)]),_:1}),a(n,{prop:"creator",label:"\u521B\u5EFA\u8005"})]),_:1},8,["data","onCurrentChange"]),a(C,{style:{"margin-top":"20px"},type:"flex",justify:"end"},{default:t(()=>[a(b,{style:{"text-align":"right"},onCurrentChange:e.handlePageChange,total:e.total,layout:"prev, pager, next, total, jumper","current-page":e.query.pageNum,"onUpdate:current-page":l[5]||(l[5]=o=>e.query.pageNum=o),"page-size":e.query.pageSize},null,8,["onCurrentChange","total","current-page","page-size"])]),_:1})]),_:1}),a(w,{width:"400px",title:"\u9879\u76EE\u7F16\u8F91","before-close":e.cancelAddProject,modelValue:e.addProjectDialog.visible,"onUpdate:modelValue":l[9]||(l[9]=o=>e.addProjectDialog.visible=o)},{footer:t(()=>[g("div",re,[a(s,{onClick:l[8]||(l[8]=o=>e.cancelAddProject())},{default:t(()=>[me]),_:1}),a(s,{onClick:e.addProject,type:"primary"},{default:t(()=>[pe]),_:1},8,["onClick"])])]),default:t(()=>[a(v,{model:e.addProjectDialog.form,"label-width":"70px"},{default:t(()=>[a(f,{prop:"name",label:"\u9879\u76EE\u540D:",required:""},{default:t(()=>[a(D,{disabled:!!e.addProjectDialog.form.id,modelValue:e.addProjectDialog.form.name,"onUpdate:modelValue":l[6]||(l[6]=o=>e.addProjectDialog.form.name=o),"auto-complete":"off"},null,8,["disabled","modelValue"])]),_:1}),a(f,{label:"\u63CF\u8FF0:"},{default:t(()=>[a(D,{modelValue:e.addProjectDialog.form.remark,"onUpdate:modelValue":l[7]||(l[7]=o=>e.addProjectDialog.form.remark=o),"auto-complete":"off"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["before-close","modelValue"]),a(w,{width:"500px",title:e.showEnvDialog.title,modelValue:e.showEnvDialog.visible,"onUpdate:modelValue":l[14]||(l[14]=o=>e.showEnvDialog.visible=o)},{default:t(()=>[g("div",ce,[h((m(),c(s,{onClick:e.showAddEnvDialog,type:"primary",icon:"plus"},{default:t(()=>[ge]),_:1},8,["onClick"])),[[r,e.permissions.saveMember]])]),a(F,{border:"",data:e.showEnvDialog.envs},{default:t(()=>[a(n,{property:"name",label:"\u73AF\u5883\u540D",width:"125"}),a(n,{property:"remark",label:"\u63CF\u8FF0",width:"125"}),a(n,{property:"createTime",label:"\u521B\u5EFA\u65F6\u95F4"},{default:t(o=>[u(I(e.$filters.dateFormat(o.row.createTime)),1)]),_:1})]),_:1},8,["data"]),a(w,{width:"400px",title:"\u6DFB\u52A0\u73AF\u5883","before-close":e.cancelAddEnv,modelValue:e.showEnvDialog.addVisible,"onUpdate:modelValue":l[13]||(l[13]=o=>e.showEnvDialog.addVisible=o)},{footer:t(()=>[g("div",he,[a(s,{onClick:l[12]||(l[12]=o=>e.cancelAddEnv())},{default:t(()=>[De]),_:1}),h((m(),c(s,{onClick:e.addEnv,type:"primary",loading:e.btnLoading},{default:t(()=>[be]),_:1},8,["onClick","loading"])),[[r,e.permissions.saveEnv]])])]),default:t(()=>[a(v,{model:e.showEnvDialog.envForm,"label-width":"70px"},{default:t(()=>[a(f,{prop:"name",label:"\u73AF\u5883\u540D:",required:""},{default:t(()=>[a(D,{modelValue:e.showEnvDialog.envForm.name,"onUpdate:modelValue":l[10]||(l[10]=o=>e.showEnvDialog.envForm.name=o),"auto-complete":"off"},null,8,["modelValue"])]),_:1}),a(f,{label:"\u63CF\u8FF0:"},{default:t(()=>[a(D,{modelValue:e.showEnvDialog.envForm.remark,"onUpdate:modelValue":l[11]||(l[11]=o=>e.showEnvDialog.envForm.remark=o),"auto-complete":"off"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["before-close","modelValue"])]),_:1},8,["title","modelValue"]),a(w,{width:"500px",title:e.showMemDialog.title,modelValue:e.showMemDialog.visible,"onUpdate:modelValue":l[21]||(l[21]=o=>e.showMemDialog.visible=o)},{default:t(()=>[g("div",fe,[h((m(),c(s,{onClick:l[15]||(l[15]=o=>e.showAddMemberDialog()),type:"primary",icon:"plus"},{default:t(()=>[we]),_:1})),[[r,e.permissions.saveMember]]),h((m(),c(s,{onClick:e.deleteMember,disabled:e.showMemDialog.chooseId==null,type:"danger",icon:"delete"},{default:t(()=>[ve]),_:1},8,["onClick","disabled"])),[[r,e.permissions.delMember]])]),a(F,{onCurrentChange:e.chooseMember,border:"",data:e.showMemDialog.members.list},{default:t(()=>[a(n,{label:"\u9009\u62E9",width:"50px"},{default:t(o=>[a(M,{modelValue:e.showMemDialog.chooseId,"onUpdate:modelValue":l[16]||(l[16]=E=>e.showMemDialog.chooseId=E),label:o.row.id},{default:t(()=>[Fe]),_:2},1032,["modelValue","label"])]),_:1}),a(n,{property:"username",label:"\u8D26\u53F7",width:"125"}),a(n,{property:"createTime",label:"\u52A0\u5165\u65F6\u95F4"},{default:t(o=>[u(I(e.$filters.dateFormat(o.row.createTime)),1)]),_:1}),a(n,{property:"creator",label:"\u5206\u914D\u8005",width:"125"})]),_:1},8,["onCurrentChange","data"]),a(b,{onCurrentChange:e.setMemebers,style:{"text-align":"center"},background:"",layout:"prev, pager, next, total, jumper",total:e.showMemDialog.members.total,"current-page":e.showMemDialog.query.pageNum,"onUpdate:current-page":l[17]||(l[17]=o=>e.showMemDialog.query.pageNum=o),"page-size":e.showMemDialog.query.pageSize},null,8,["onCurrentChange","total","current-page","page-size"]),a(w,{width:"400px",title:"\u6DFB\u52A0\u6210\u5458","before-close":e.cancelAddMember,modelValue:e.showMemDialog.addVisible,"onUpdate:modelValue":l[20]||(l[20]=o=>e.showMemDialog.addVisible=o)},{footer:t(()=>[g("div",Ee,[a(s,{onClick:l[19]||(l[19]=o=>e.cancelAddMember())},{default:t(()=>[ye]),_:1}),h((m(),c(s,{onClick:e.addMember,type:"primary",loading:e.btnLoading},{default:t(()=>[Me]),_:1},8,["onClick","loading"])),[[r,e.permissions.saveMember]])])]),default:t(()=>[a(v,{model:e.showMemDialog.memForm,"label-width":"70px"},{default:t(()=>[a(f,{label:"\u8D26\u53F7:"},{default:t(()=>[a(P,{style:{width:"100%"},remote:"","remote-method":e.getAccount,modelValue:e.showMemDialog.memForm.accountId,"onUpdate:modelValue":l[18]||(l[18]=o=>e.showMemDialog.memForm.accountId=o),filterable:"",placeholder:"\u8BF7\u9009\u62E9"},{default:t(()=>[(m(!0),z(Z,null,x(e.showMemDialog.accounts,o=>(m(),c(A,{key:o.id,label:o.username,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["remote-method","modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["before-close","modelValue"])]),_:1},8,["title","modelValue"])])}var Ie=K(oe,[["render",je]]);export{Ie as default};
