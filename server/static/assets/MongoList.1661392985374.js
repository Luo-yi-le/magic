var X=Object.defineProperty,Y=Object.defineProperties;var Z=Object.getOwnPropertyDescriptors;var T=Object.getOwnPropertySymbols;var x=Object.prototype.hasOwnProperty,ee=Object.prototype.propertyIsEnumerable;var U=(e,o,c)=>o in e?X(e,o,{enumerable:!0,configurable:!0,writable:!0,value:c}):e[o]=c,_=(e,o)=>{for(var c in o||(o={}))x.call(o,c)&&U(e,c,o[c]);if(T)for(var c of T(o))ee.call(o,c)&&U(e,c,o[c]);return e},M=(e,o)=>Y(e,Z(o));import{m as C}from"./api.16613929853746.js";import{p as N}from"./api.16613929853744.js";import{m as le}from"./api.16613929853743.js";import{A as O,q as ae,r as P,v as oe,t as H,_ as G,E as k,b as u,d as f,e as F,g as l,w as a,h as j,F as q,j as A,k as z,z as L,B as i,o as te,i as g,G as ne}from"./index.1661392985374.js";import{f as ie}from"./format.1661392985374.js";import"./Api.1661392985374.js";const se=O({name:"MongoEdit",props:{visible:{type:Boolean},projects:{type:Array},mongo:{type:[Boolean,Object]},title:{type:String}},setup(e,{emit:o}){const c=ae(null),r=P({dialogVisible:!1,projects:[],envs:[],sshTunnelMachineList:[],form:{id:null,name:null,uri:null,enableSshTunnel:-1,sshTunnelMachineId:null,project:null,projectId:null,envId:null,env:null},btnLoading:!1,rules:{projectId:[{required:!0,message:"\u8BF7\u9009\u62E9\u9879\u76EE",trigger:["change","blur"]}],envId:[{required:!0,message:"\u8BF7\u9009\u62E9\u73AF\u5883",trigger:["change","blur"]}],name:[{required:!0,message:"\u8BF7\u8F93\u5165\u540D\u79F0",trigger:["change","blur"]}],uri:[{required:!0,message:"\u8BF7\u8F93\u5165mongo uri",trigger:["change","blur"]}]}});oe(e,async s=>{r.dialogVisible=s.visible,r.dialogVisible&&(r.projects=s.projects,s.mongo?(E(s.mongo.projectId),r.form=_({},s.mongo)):(r.envs=[],r.form={db:0}),y())});const y=async()=>{if(r.form.enableSshTunnel==1&&r.sshTunnelMachineList.length==0){const s=await le.list.request({pageNum:1,pageSize:100});r.sshTunnelMachineList=s.list}},E=async s=>{r.envs=await N.projectEnvs.request({projectId:s})},p=s=>{for(let m of r.projects)m.id==s&&(r.form.project=m.name);r.form.envId=null,r.form.env=null,r.envs=[],E(s)},h=s=>{for(let m of r.envs)m.id==s&&(r.form.env=m.name)},b=async()=>{c.value.validate(async s=>{if(s){const m=_({},r.form);C.saveMongo.request(m).then(()=>{k.success("\u4FDD\u5B58\u6210\u529F"),o("val-change",r.form),r.btnLoading=!0,setTimeout(()=>{r.btnLoading=!1},1e3),v()})}else return k.error("\u8BF7\u6B63\u786E\u586B\u5199\u4FE1\u606F"),!1})},v=()=>{o("update:visible",!1),o("cancel")};return M(_({},H(r)),{mongoForm:c,changeProject:p,getSshTunnelMachines:y,changeEnv:h,btnOk:b,cancel:v})}}),ue=i(" \u673A\u5668: "),re={class:"dialog-footer"},de=i("\u53D6 \u6D88"),ge=i("\u786E \u5B9A");function me(e,o,c,r,y,E){const p=u("el-option"),h=u("el-select"),b=u("el-form-item"),v=u("el-input"),s=u("el-checkbox"),m=u("el-col"),D=u("el-form"),S=u("el-button"),B=u("el-dialog");return f(),F("div",null,[l(B,{title:e.title,modelValue:e.dialogVisible,"onUpdate:modelValue":o[7]||(o[7]=t=>e.dialogVisible=t),"before-close":e.cancel,"close-on-click-modal":!1,width:"38%","destroy-on-close":!0},{footer:a(()=>[j("div",re,[l(S,{onClick:o[6]||(o[6]=t=>e.cancel())},{default:a(()=>[de]),_:1}),l(S,{type:"primary",loading:e.btnLoading,onClick:e.btnOk},{default:a(()=>[ge]),_:1},8,["loading","onClick"])])]),default:a(()=>[l(D,{model:e.form,ref:"mongoForm",rules:e.rules,"label-width":"85px"},{default:a(()=>[l(b,{prop:"projectId",label:"\u9879\u76EE",required:""},{default:a(()=>[l(h,{style:{width:"100%"},modelValue:e.form.projectId,"onUpdate:modelValue":o[0]||(o[0]=t=>e.form.projectId=t),placeholder:"\u8BF7\u9009\u62E9\u9879\u76EE",onChange:e.changeProject,filterable:""},{default:a(()=>[(f(!0),F(q,null,A(e.projects,t=>(f(),z(p,{key:t.id,label:`${t.name} [${t.remark}]`,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"])]),_:1}),l(b,{prop:"envId",label:"\u73AF\u5883",required:""},{default:a(()=>[l(h,{onChange:e.changeEnv,style:{width:"100%"},modelValue:e.form.envId,"onUpdate:modelValue":o[1]||(o[1]=t=>e.form.envId=t),placeholder:"\u8BF7\u9009\u62E9\u73AF\u5883"},{default:a(()=>[(f(!0),F(q,null,A(e.envs,t=>(f(),z(p,{key:t.id,label:`${t.name} [${t.remark}]`,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["onChange","modelValue"])]),_:1}),l(b,{prop:"name",label:"\u540D\u79F0",required:""},{default:a(()=>[l(v,{modelValue:e.form.name,"onUpdate:modelValue":o[2]||(o[2]=t=>e.form.name=t),modelModifiers:{trim:!0},placeholder:"\u8BF7\u8F93\u5165\u540D\u79F0","auto-complete":"off"},null,8,["modelValue"])]),_:1}),l(b,{prop:"uri",label:"uri",required:""},{default:a(()=>[l(v,{type:"textarea",rows:2,modelValue:e.form.uri,"onUpdate:modelValue":o[3]||(o[3]=t=>e.form.uri=t),modelModifiers:{trim:!0},placeholder:"\u5F62\u5982 mongodb://username:password@host1:port1","auto-complete":"off"},null,8,["modelValue"])]),_:1}),l(b,{prop:"enableSshTunnel",label:"SSH\u96A7\u9053:"},{default:a(()=>[l(m,{span:3},{default:a(()=>[l(s,{onChange:e.getSshTunnelMachines,modelValue:e.form.enableSshTunnel,"onUpdate:modelValue":o[4]||(o[4]=t=>e.form.enableSshTunnel=t),"true-label":1,"false-label":-1},null,8,["onChange","modelValue"])]),_:1}),e.form.enableSshTunnel==1?(f(),z(m,{key:0,span:2},{default:a(()=>[ue]),_:1})):L("",!0),e.form.enableSshTunnel==1?(f(),z(m,{key:1,span:19},{default:a(()=>[l(h,{style:{width:"100%"},modelValue:e.form.sshTunnelMachineId,"onUpdate:modelValue":o[5]||(o[5]=t=>e.form.sshTunnelMachineId=t),placeholder:"\u8BF7\u9009\u62E9SSH\u96A7\u9053\u673A\u5668"},{default:a(()=>[(f(!0),F(q,null,A(e.sshTunnelMachineList,t=>(f(),z(p,{key:t.id,label:`${t.ip}:${t.port} [${t.name}]`,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):L("",!0)]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue","before-close"])])}var ce=G(se,[["render",me]]);const pe=O({name:"MongoList",components:{MongoEdit:ce},setup(){const e=P({projects:[],list:[],total:0,currentId:null,currentData:null,query:{pageNum:1,pageSize:10,prjectId:null,clusterId:null},mongoEditDialog:{visible:!1,data:null,title:"\u65B0\u589Emongo"},databaseDialog:{visible:!1,data:[],title:"",statsDialog:{visible:!1,data:{},title:""}},collectionsDialog:{database:"",visible:!1,data:[],title:"",statsDialog:{visible:!1,data:{},title:""}},createCollectionDialog:{visible:!1,form:{name:""}}});te(async()=>{D(),e.projects=await N.accountProjects.request(null)});const o=t=>{e.query.pageNum=t,D()},c=t=>{!t||(e.currentId=t.id,e.currentData=t)},r=async t=>{e.databaseDialog.data=(await C.databases.request({id:t})).Databases,e.databaseDialog.title="\u6570\u636E\u5E93\u5217\u8868",e.databaseDialog.visible=!0},y=async t=>{e.databaseDialog.statsDialog.data=await C.runCommand.request({id:e.currentId,database:t,command:{dbStats:1}}),e.databaseDialog.statsDialog.title=`'${t}' stats`,e.databaseDialog.statsDialog.visible=!0},E=async t=>{e.collectionsDialog.database=t,e.collectionsDialog.data=[],p(t),e.collectionsDialog.title=`'${t}' \u96C6\u5408`,e.collectionsDialog.visible=!0},p=async t=>{const $=await C.collections.request({id:e.currentId,database:t}),d=[];for(let I of $)d.push({name:I});e.collectionsDialog.data=d},h=async t=>{e.collectionsDialog.statsDialog.data=await C.runCommand.request({id:e.currentId,database:e.collectionsDialog.database,command:{collStats:t}}),e.collectionsDialog.statsDialog.title=`'${t}' stats`,e.collectionsDialog.statsDialog.visible=!0},b=async t=>{await C.runCommand.request({id:e.currentId,database:e.collectionsDialog.database,command:{drop:t}}),k.success("\u96C6\u5408\u5220\u9664\u6210\u529F"),p(e.collectionsDialog.database)},v=()=>{e.createCollectionDialog.visible=!0},s=async()=>{const t=e.createCollectionDialog.form;await C.runCommand.request({id:e.currentId,database:e.collectionsDialog.database,command:{create:t.name}}),k.success("\u96C6\u5408\u521B\u5EFA\u6210\u529F"),e.createCollectionDialog.visible=!1,e.createCollectionDialog.form={},p(e.collectionsDialog.database)},m=async()=>{try{await ne.confirm("\u786E\u5B9A\u5220\u9664\u8BE5mongo?","\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}),await C.deleteMongo.request({id:e.currentId}),k.success("\u5220\u9664\u6210\u529F"),e.currentData=null,e.currentId=null,D()}catch{}},D=async()=>{const t=await C.mongoList.request(e.query);e.list=t.list,e.total=t.total},S=(t=!1)=>{t?(e.mongoEditDialog.data=null,e.mongoEditDialog.title="\u65B0\u589Emongo"):(e.mongoEditDialog.data=e.currentData,e.mongoEditDialog.title="\u4FEE\u6539mongo"),e.mongoEditDialog.visible=!0},B=()=>{e.currentId=null,e.currentData=null,D()};return M(_({},H(e)),{search:D,handlePageChange:o,choose:c,showDatabases:r,showDatabaseStats:y,showCollections:E,showCollectionStats:h,onDeleteCollection:b,showCreateCollectionDialog:v,onCreateCollection:s,formatByteSize:ie,deleteMongo:m,editMongo:S,valChange:B})}}),fe=i("\u6DFB\u52A0"),be=i("\u7F16\u8F91"),De=i("\u5220\u9664"),he={style:{float:"right"}},ve=j("i",null,null,-1),Ce=i("\u6570\u636E\u5E93"),ye=i("stats"),Ee=i("\u96C6\u5408"),Se=i("\u65B0\u5EFA"),we=i("stats"),ze=i("\u5220\u9664"),Fe=i("\u53D6 \u6D88"),Be=i("\u786E \u5B9A");function Ve(e,o,c,r,y,E){const p=u("el-button"),h=u("el-option"),b=u("el-select"),v=u("el-radio"),s=u("el-table-column"),m=u("el-link"),D=u("el-table"),S=u("el-pagination"),B=u("el-row"),t=u("el-card"),$=u("el-divider"),d=u("el-descriptions-item"),I=u("el-descriptions"),V=u("el-dialog"),R=u("el-popconfirm"),J=u("el-input"),K=u("el-form-item"),Q=u("el-form"),W=u("mongo-edit");return f(),F("div",null,[l(t,null,{default:a(()=>[l(p,{type:"primary",icon:"plus",onClick:o[0]||(o[0]=n=>e.editMongo(!0)),plain:""},{default:a(()=>[fe]),_:1}),l(p,{type:"primary",icon:"edit",disabled:e.currentId==null,onClick:o[1]||(o[1]=n=>e.editMongo(!1)),plain:""},{default:a(()=>[be]),_:1},8,["disabled"]),l(p,{type:"danger",icon:"delete",disabled:e.currentId==null,onClick:e.deleteMongo,plain:""},{default:a(()=>[De]),_:1},8,["disabled","onClick"]),j("div",he,[l(b,{modelValue:e.query.projectId,"onUpdate:modelValue":o[2]||(o[2]=n=>e.query.projectId=n),placeholder:"\u8BF7\u9009\u62E9\u9879\u76EE",filterable:"",clearable:""},{default:a(()=>[(f(!0),F(q,null,A(e.projects,n=>(f(),z(h,{key:n.id,label:`${n.name} [${n.remark}]`,value:n.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),l(p,{class:"ml5",onClick:e.search,type:"success",icon:"search"},null,8,["onClick"])]),l(D,{data:e.list,style:{width:"100%"},onCurrentChange:e.choose,stripe:""},{default:a(()=>[l(s,{label:"\u9009\u62E9",width:"60px"},{default:a(n=>[l(v,{modelValue:e.currentId,"onUpdate:modelValue":o[3]||(o[3]=w=>e.currentId=w),label:n.row.id},{default:a(()=>[ve]),_:2},1032,["modelValue","label"])]),_:1}),l(s,{prop:"project",label:"\u9879\u76EE",width:""}),l(s,{prop:"env",label:"\u73AF\u5883",width:""}),l(s,{prop:"name",label:"\u540D\u79F0",width:""}),l(s,{prop:"uri",label:"\u8FDE\u63A5uri","min-width":"150","show-overflow-tooltip":""},{default:a(n=>[i(g(n.row.uri.split("@")[1]),1)]),_:1}),l(s,{prop:"createTime",label:"\u521B\u5EFA\u65F6\u95F4","min-width":"150"},{default:a(n=>[i(g(e.$filters.dateFormat(n.row.createTime)),1)]),_:1}),l(s,{prop:"creator",label:"\u521B\u5EFA\u4EBA"}),l(s,{label:"\u64CD\u4F5C",width:""},{default:a(n=>[l(m,{type:"primary",onClick:w=>e.showDatabases(n.row.id),plain:"",size:"small",underline:!1},{default:a(()=>[Ce]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","onCurrentChange"]),l(B,{style:{"margin-top":"20px"},type:"flex",justify:"end"},{default:a(()=>[l(S,{style:{"text-align":"right"},onCurrentChange:e.handlePageChange,total:e.total,layout:"prev, pager, next, total, jumper","current-page":e.query.pageNum,"onUpdate:current-page":o[4]||(o[4]=n=>e.query.pageNum=n),"page-size":e.query.pageSize},null,8,["onCurrentChange","total","current-page","page-size"])]),_:1})]),_:1}),l(V,{width:"800px",title:e.databaseDialog.title,modelValue:e.databaseDialog.visible,"onUpdate:modelValue":o[6]||(o[6]=n=>e.databaseDialog.visible=n)},{default:a(()=>[l(D,{data:e.databaseDialog.data,size:"small"},{default:a(()=>[l(s,{"min-width":"130",property:"Name",label:"\u5E93\u540D"}),l(s,{"min-width":"90",property:"SizeOnDisk",label:"size"},{default:a(n=>[i(g(e.formatByteSize(n.row.SizeOnDisk)),1)]),_:1}),l(s,{"min-width":"80",property:"Empty",label:"\u662F\u5426\u4E3A\u7A7A"}),l(s,{"min-width":"80",label:"\u64CD\u4F5C"},{default:a(n=>[l(m,{type:"success",onClick:w=>e.showDatabaseStats(n.row.Name),plain:"",size:"small",underline:!1},{default:a(()=>[ye]),_:2},1032,["onClick"]),l($,{direction:"vertical","border-style":"dashed"}),l(m,{type:"primary",onClick:w=>e.showCollections(n.row.Name),plain:"",size:"small",underline:!1},{default:a(()=>[Ee]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),l(V,{width:"700px",title:e.databaseDialog.statsDialog.title,modelValue:e.databaseDialog.statsDialog.visible,"onUpdate:modelValue":o[5]||(o[5]=n=>e.databaseDialog.statsDialog.visible=n)},{default:a(()=>[l(I,{title:"\u5E93\u72B6\u6001\u4FE1\u606F",column:3,border:"",size:"small"},{default:a(()=>[l(d,{label:"db","label-align":"right",align:"center"},{default:a(()=>[i(g(e.databaseDialog.statsDialog.data.db),1)]),_:1}),l(d,{label:"collections","label-align":"right",align:"center"},{default:a(()=>[i(g(e.databaseDialog.statsDialog.data.collections),1)]),_:1}),l(d,{label:"objects","label-align":"right",align:"center"},{default:a(()=>[i(g(e.databaseDialog.statsDialog.data.objects),1)]),_:1}),l(d,{label:"indexes","label-align":"right",align:"center"},{default:a(()=>[i(g(e.databaseDialog.statsDialog.data.indexes),1)]),_:1}),l(d,{label:"avgObjSize","label-align":"right",align:"center"},{default:a(()=>[i(g(e.formatByteSize(e.databaseDialog.statsDialog.data.avgObjSize)),1)]),_:1}),l(d,{label:"dataSize","label-align":"right",align:"center"},{default:a(()=>[i(g(e.formatByteSize(e.databaseDialog.statsDialog.data.dataSize)),1)]),_:1}),l(d,{label:"totalSize","label-align":"right",align:"center"},{default:a(()=>[i(g(e.formatByteSize(e.databaseDialog.statsDialog.data.totalSize)),1)]),_:1}),l(d,{label:"storageSize","label-align":"right",align:"center"},{default:a(()=>[i(g(e.formatByteSize(e.databaseDialog.statsDialog.data.storageSize)),1)]),_:1}),l(d,{label:"fsTotalSize","label-align":"right",align:"center"},{default:a(()=>[i(g(e.formatByteSize(e.databaseDialog.statsDialog.data.fsTotalSize)),1)]),_:1}),l(d,{label:"fsUsedSize","label-align":"right",align:"center"},{default:a(()=>[i(g(e.formatByteSize(e.databaseDialog.statsDialog.data.fsUsedSize)),1)]),_:1}),l(d,{label:"indexSize","label-align":"right",align:"center"},{default:a(()=>[i(g(e.formatByteSize(e.databaseDialog.statsDialog.data.indexSize)),1)]),_:1})]),_:1})]),_:1},8,["title","modelValue"])]),_:1},8,["title","modelValue"]),l(V,{width:"600px",title:e.collectionsDialog.title,modelValue:e.collectionsDialog.visible,"onUpdate:modelValue":o[8]||(o[8]=n=>e.collectionsDialog.visible=n)},{default:a(()=>[j("div",null,[l(p,{onClick:e.showCreateCollectionDialog,type:"primary",icon:"plus",size:"small"},{default:a(()=>[Se]),_:1},8,["onClick"])]),l(D,{border:"",stripe:"",data:e.collectionsDialog.data,size:"small"},{default:a(()=>[l(s,{prop:"name",label:"\u540D\u79F0","show-overflow-tooltip":""}),l(s,{"min-width":"80",label:"\u64CD\u4F5C"},{default:a(n=>[l(m,{type:"success",onClick:w=>e.showCollectionStats(n.row.name),plain:"",size:"small",underline:!1},{default:a(()=>[we]),_:2},1032,["onClick"]),l($,{direction:"vertical","border-style":"dashed"}),l(R,{onConfirm:w=>e.onDeleteCollection(n.row.name),title:"\u786E\u5B9A\u5220\u9664\u8BE5\u96C6\u5408?"},{reference:a(()=>[l(m,{type:"danger",plain:"",size:"small",underline:!1},{default:a(()=>[ze]),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"]),l(V,{width:"700px",title:e.collectionsDialog.statsDialog.title,modelValue:e.collectionsDialog.statsDialog.visible,"onUpdate:modelValue":o[7]||(o[7]=n=>e.collectionsDialog.statsDialog.visible=n)},{default:a(()=>[l(I,{title:"\u96C6\u5408\u72B6\u6001\u4FE1\u606F",column:3,border:"",size:"small"},{default:a(()=>[l(d,{label:"ns","label-align":"right",span:2,align:"center"},{default:a(()=>[i(g(e.collectionsDialog.statsDialog.data.ns),1)]),_:1}),l(d,{label:"count","label-align":"right",align:"center"},{default:a(()=>[i(g(e.collectionsDialog.statsDialog.data.count),1)]),_:1}),l(d,{label:"avgObjSize","label-align":"right",align:"center"},{default:a(()=>[i(g(e.formatByteSize(e.collectionsDialog.statsDialog.data.avgObjSize)),1)]),_:1}),l(d,{label:"nindexes","label-align":"right",align:"center"},{default:a(()=>[i(g(e.collectionsDialog.statsDialog.data.nindexes),1)]),_:1}),l(d,{label:"size","label-align":"right",align:"center"},{default:a(()=>[i(g(e.formatByteSize(e.collectionsDialog.statsDialog.data.size)),1)]),_:1}),l(d,{label:"totalSize","label-align":"right",align:"center"},{default:a(()=>[i(g(e.formatByteSize(e.collectionsDialog.statsDialog.data.totalSize)),1)]),_:1}),l(d,{label:"storageSize","label-align":"right",align:"center"},{default:a(()=>[i(g(e.formatByteSize(e.collectionsDialog.statsDialog.data.storageSize)),1)]),_:1}),l(d,{label:"freeStorageSize","label-align":"right",align:"center"},{default:a(()=>[i(g(e.formatByteSize(e.collectionsDialog.statsDialog.data.freeStorageSize)),1)]),_:1})]),_:1})]),_:1},8,["title","modelValue"])]),_:1},8,["title","modelValue"]),l(V,{width:"400px",title:"\u65B0\u5EFA\u96C6\u5408",modelValue:e.createCollectionDialog.visible,"onUpdate:modelValue":o[11]||(o[11]=n=>e.createCollectionDialog.visible=n),"destroy-on-close":!0},{footer:a(()=>[j("div",null,[l(p,{onClick:o[10]||(o[10]=n=>e.createCollectionDialog.visible=!1)},{default:a(()=>[Fe]),_:1}),l(p,{onClick:e.onCreateCollection,type:"primary"},{default:a(()=>[Be]),_:1},8,["onClick"])])]),default:a(()=>[l(Q,{model:e.createCollectionDialog.form,"label-width":"70px"},{default:a(()=>[l(K,{prop:"name",label:"\u96C6\u5408\u540D",required:""},{default:a(()=>[l(J,{modelValue:e.createCollectionDialog.form.name,"onUpdate:modelValue":o[9]||(o[9]=n=>e.createCollectionDialog.form.name=n),clearable:""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(W,{onValChange:e.valChange,projects:e.projects,title:e.mongoEditDialog.title,visible:e.mongoEditDialog.visible,"onUpdate:visible":o[12]||(o[12]=n=>e.mongoEditDialog.visible=n),mongo:e.mongoEditDialog.data,"onUpdate:mongo":o[13]||(o[13]=n=>e.mongoEditDialog.data=n)},null,8,["onValChange","projects","title","visible","mongo"])])}var Me=G(pe,[["render",Ve]]);export{Me as default};
