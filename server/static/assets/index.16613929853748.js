var L=Object.defineProperty;var B=Object.getOwnPropertySymbols;var M=Object.prototype.hasOwnProperty,K=Object.prototype.propertyIsEnumerable;var D=(e,o,s)=>o in e?L(e,o,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[o]=s,b=(e,o)=>{for(var s in o||(o={}))M.call(o,s)&&D(e,s,o[s]);if(B)for(var s of B(o))K.call(o,s)&&D(e,s,o[s]);return e};import{A as Z,a as E,S as j,u as Q,q as V,r as I,o as W,P,c as k,t as T,_ as $,f as X,U as F,V as G,W as x,E as A,b as c,d as R,e as S,g as t,w as l,X as H,h as u,Q as q,R as z,B as U,i as J,n as O,T as Y,x as ee,y as oe}from"./index.1661392985374.js";import{R as y}from"./rsa.1661392985374.js";import"./assert.1661392985374.js";const ne=Z({name:"AccountLogin",setup(){const e=E(),o=j(),s=Q(),g=V(null),_=V(null),a=I({captchaImage:"",loginForm:{username:"",password:"",captcha:"",cid:""},changePwdDialog:{visible:!1,form:{username:"",oldPassword:"",newPassword:""},rules:{newPassword:[{required:!0,message:"\u8BF7\u8F93\u5165\u65B0\u5BC6\u7801",trigger:"blur"},{pattern:/^(?=.*[A-Za-z])(?=.*\d)(?=.*[`~!@#$%^&*()_+<>?:"{},.\/\\;'[\]])[A-Za-z\d`~!@#$%^&*()_+<>?:"{},.\/\\;'[\]]{8,}$/,message:"\u987B\u4E3A8\u4F4D\u4EE5\u4E0A\u4E14\u5305\u542B\u5B57\u2E9F\u2F24\u2F29\u5199+\u6570\u5B57+\u7279\u6B8A\u7B26\u53F7",trigger:"blur"}]}},rules:{username:[{required:!0,message:"\u8BF7\u8F93\u5165\u7528\u6237\u540D",trigger:"blur"}],password:[{required:!0,message:"\u8BF7\u8F93\u5165\u5BC6\u7801",trigger:"blur"}],captcha:[{required:!0,message:"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801",trigger:"blur"}]},loading:{signIn:!1,changePwd:!1}});W(()=>{sessionStorage.removeItem("RsaPublicKey"),i()});const i=async()=>{let n=await P.captcha();a.captchaImage=n.base64Captcha,a.loginForm.cid=n.cid},r=k(()=>X(new Date)),p=()=>{g.value.validate(n=>{if(n)w();else return!1})},w=async()=>{a.loading.signIn=!0;let n;const d=a.loginForm.password;try{const h=b({},a.loginForm);h.password=await y(d),n=await P.login(h),F("token",n.token),F("menus",n.menus)}catch(h){a.loading.signIn=!1,a.loginForm.captcha="",h.code&&h.code==401?(a.changePwdDialog.form.username=a.loginForm.username,a.changePwdDialog.form.oldPassword=d,a.changePwdDialog.form.newPassword="",a.changePwdDialog.visible=!0):i();return}const f={username:a.loginForm.username,photo:G(a.loginForm.username),time:new Date().getTime(),permissions:n.permissions,lastLoginTime:n.lastLoginTime,lastLoginIp:n.lastLoginIp};F("userInfo",f),e.dispatch("userInfos/setUserInfos",f),e.state.themeConfig.themeConfig.isRequestRoutes?(await x(),m()):(await x(),m())},m=()=>{var d;let n=r.value;(d=o.query)!=null&&d.redirect?s.push(o.query.redirect):s.push("/"),setTimeout(()=>{a.loading.signIn=!0,A.success(`${n}\uFF0C\u6B22\u8FCE\u56DE\u6765\uFF01`)},300)};return b({getCaptcha:i,currentTime:r,loginFormRef:g,changePwdFormRef:_,login:p,changePwd:()=>{_.value.validate(async n=>{if(!n)return!1;try{a.loading.changePwd=!0;const d=a.changePwdDialog.form,f=b({},d);f.oldPassword=await y(d.oldPassword),f.newPassword=await y(d.newPassword),await P.changePwd(f),A.success("\u5BC6\u7801\u4FEE\u6539\u6210\u529F, \u65B0\u5BC6\u7801\u5DF2\u586B\u5145\u81F3\u767B\u5F55\u5BC6\u7801\u6846"),a.loginForm.password=a.changePwdDialog.form.newPassword,a.changePwdDialog.visible=!1,i()}finally{a.loading.changePwd=!1}})},cancelChangePwd:()=>{a.changePwdDialog.visible=!1,a.changePwdDialog.form.newPassword="",a.changePwdDialog.form.oldPassword="",a.changePwdDialog.form.username="",i()}},T(a))}}),ae=e=>(q("data-v-f7f12fc2"),e=e(),z(),e),te={class:"login-content-code"},le=["src"],se=ae(()=>u("span",null,"\u767B \u5F55",-1)),ie={class:"dialog-footer"},re=U("\u53D6 \u6D88"),ue=U("\u786E \u5B9A");function ce(e,o,s,g,_,a){const i=c("el-input"),r=c("el-form-item"),p=c("el-col"),w=c("el-row"),m=c("el-button"),v=c("el-form"),C=c("el-dialog");return R(),S("div",null,[t(v,{ref:"loginFormRef",model:e.loginForm,rules:e.rules,class:"login-content-form",size:"large"},{default:l(()=>[t(r,{prop:"username"},{default:l(()=>[t(i,{type:"text",placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u540D","prefix-icon":"user",modelValue:e.loginForm.username,"onUpdate:modelValue":o[0]||(o[0]=n=>e.loginForm.username=n),clearable:"",autocomplete:"off"},null,8,["modelValue"])]),_:1}),t(r,{prop:"password"},{default:l(()=>[t(i,{type:"password",placeholder:"\u8BF7\u8F93\u5165\u5BC6\u7801","prefix-icon":"lock",modelValue:e.loginForm.password,"onUpdate:modelValue":o[1]||(o[1]=n=>e.loginForm.password=n),autocomplete:"off","show-password":""},null,8,["modelValue"])]),_:1}),t(r,{prop:"captcha"},{default:l(()=>[t(w,{gutter:15},{default:l(()=>[t(p,{span:16},{default:l(()=>[t(i,{type:"text",maxlength:"6",placeholder:"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801","prefix-icon":"position",modelValue:e.loginForm.captcha,"onUpdate:modelValue":o[2]||(o[2]=n=>e.loginForm.captcha=n),clearable:"",autocomplete:"off",onKeyup:H(e.login,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),t(p,{span:8},{default:l(()=>[u("div",te,[u("img",{class:"login-content-code-img",onClick:o[3]||(o[3]=(...n)=>e.getCaptcha&&e.getCaptcha(...n)),width:"130px",height:"40px",src:e.captchaImage,style:{cursor:"pointer"}},null,8,le)])]),_:1})]),_:1})]),_:1}),t(r,null,{default:l(()=>[t(m,{type:"primary",class:"login-content-submit",round:"",onClick:e.login,loading:e.loading.signIn},{default:l(()=>[se]),_:1},8,["onClick","loading"])]),_:1})]),_:1},8,["model","rules"]),t(C,{title:"\u4FEE\u6539\u5BC6\u7801",modelValue:e.changePwdDialog.visible,"onUpdate:modelValue":o[7]||(o[7]=n=>e.changePwdDialog.visible=n),"close-on-click-modal":!1,width:"450px","destroy-on-close":!0},{footer:l(()=>[u("div",ie,[t(m,{onClick:e.cancelChangePwd},{default:l(()=>[re]),_:1},8,["onClick"]),t(m,{onClick:e.changePwd,type:"primary",loading:e.loading.changePwd},{default:l(()=>[ue]),_:1},8,["onClick","loading"])])]),default:l(()=>[t(v,{model:e.changePwdDialog.form,rules:e.changePwdDialog.rules,ref:"changePwdFormRef","label-width":"65px"},{default:l(()=>[t(r,{prop:"username",label:"\u7528\u6237\u540D",required:""},{default:l(()=>[t(i,{modelValue:e.changePwdDialog.form.username,"onUpdate:modelValue":o[4]||(o[4]=n=>e.changePwdDialog.form.username=n),modelModifiers:{trim:!0},disabled:""},null,8,["modelValue"])]),_:1}),t(r,{prop:"oldPassword",label:"\u65E7\u5BC6\u7801",required:""},{default:l(()=>[t(i,{modelValue:e.changePwdDialog.form.oldPassword,"onUpdate:modelValue":o[5]||(o[5]=n=>e.changePwdDialog.form.oldPassword=n),modelModifiers:{trim:!0},autocomplete:"new-password",type:"password"},null,8,["modelValue"])]),_:1}),t(r,{prop:"newPassword",label:"\u65B0\u5BC6\u7801",required:""},{default:l(()=>[t(i,{modelValue:e.changePwdDialog.form.newPassword,"onUpdate:modelValue":o[6]||(o[6]=n=>e.changePwdDialog.form.newPassword=n),modelModifiers:{trim:!0},placeholder:"\u987B\u4E3A8\u4F4D\u4EE5\u4E0A\u4E14\u5305\u542B\u5B57\u2E9F\u2F24\u2F29\u5199+\u6570\u5B57+\u7279\u6B8A\u7B26\u53F7",type:"password",autocomplete:"new-password"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])])}var de=$(ne,[["render",ce],["__scopeId","data-v-f7f12fc2"]]);const ge={name:"LoginPage",components:{Account:de},setup(){const e=E(),o=I({tabsActiveName:"account",isTabPaneShow:!0}),s=k(()=>e.state.themeConfig.themeConfig);return b({onTabsClick:()=>{o.isTabPaneShow=!o.isTabPaneShow},getThemeConfig:s},T(o))}},N=e=>(q("data-v-ccec90f4"),e=e(),z(),e),pe={class:"login-container"},me={class:"login-logo"},fe={class:"login-content-main"},we=N(()=>u("h4",{class:"login-content-title"},"magic",-1)),he=N(()=>u("div",{class:"login-copyright"},[u("div",{class:"mb5 login-copyright-company"},"magic"),u("div",{class:"login-copyright-msg"},"magic")],-1));function be(e,o,s,g,_,a){const i=c("Account"),r=c("el-tab-pane"),p=c("el-tabs");return R(),S("div",pe,[u("div",me,[u("span",null,J(g.getThemeConfig.globalViceTitle),1)]),u("div",{class:O(["login-content",{"login-content-mobile":e.tabsActiveName==="mobile"}])},[u("div",fe,[we,t(p,{modelValue:e.tabsActiveName,"onUpdate:modelValue":o[0]||(o[0]=w=>e.tabsActiveName=w),onTabClick:g.onTabsClick},{default:l(()=>[t(r,{label:"\u8D26\u53F7\u5BC6\u7801\u767B\u5F55",name:"account",disabled:e.tabsActiveName==="account"},{default:l(()=>[t(Y,{name:"el-zoom-in-center"},{default:l(()=>[ee(t(i,null,null,512),[[oe,e.isTabPaneShow]])]),_:1})]),_:1},8,["disabled"])]),_:1},8,["modelValue","onTabClick"])])],2),he])}var ye=$(ge,[["render",be],["__scopeId","data-v-ccec90f4"]]);export{ye as default};
